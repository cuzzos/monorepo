# Thiccc Application - Justfile
#
# From repo root: just thiccc <recipe>
# From this dir:  just <recipe>

mod web 'build/web.justfile'
mod ios 'build/ios.justfile'
mod db 'build/db.justfile'

# Show available commands
default:
    @just --list

# =============================================================================
# Deployment Commands
# =============================================================================

# Usage: just thiccc deploy <api|web> [preview|prod]
deploy target env="preview":
    #!/usr/bin/env bash
    set -euo pipefail
    if [[ "{{ target }}" == "api" ]]; then
        echo "ðŸš€ Deploying API to Railway ({{ env }})..."
        railway up
    elif [[ "{{ target }}" == "web" ]]; then
        echo "ðŸš€ Deploying web to Vercel ({{ env }})..."
        cd web_frontend
        if [[ "{{ env }}" == "prod" ]]; then vercel --prod; else vercel; fi
    fi

# =============================================================================
# Cleanup Commands
# =============================================================================

# Clean all build artifacts
clean:
    @echo "ðŸ§¹ Cleaning build artifacts..."
    @echo ""
    @echo "  Stopping Docker containers (releases file locks)..."
    @docker compose -f build/docker-compose.web-dev.yaml --project-directory . down 2>/dev/null || true
    @echo "  Removing target/..."
    @rm -rf target/ 2>/dev/null || true
    @echo "  Removing local Rust targets..."
    @rm -rf app/shared/target/ 2>/dev/null || true
    @rm -rf shared/target/ 2>/dev/null || true
    @echo "  Removing node_modules & .next/..."
    @rm -rf web_frontend/node_modules/ 2>/dev/null || true
    @rm -rf web_frontend/.next/ 2>/dev/null || true
    @echo "  Removing build logs..."
    @rm -f xcodebuild.log 2>/dev/null || true
    @echo "  Removing Xcode DerivedData..."
    @rm -rf ~/Library/Developer/Xcode/DerivedData/Thiccc-* 2>/dev/null || true
    @echo ""
    @echo "âœ… Clean complete!"
    @echo ""
    @echo "Note: Docker volumes preserved. To also reset Docker:"
    @echo "  just thiccc web reset"
