# Thiccc Application - Justfile
#
# From repo root: just thiccc <recipe>
# From this dir:  just <recipe>

mod web 'build/web.justfile'
mod ios 'build/ios.justfile'
mod db 'build/db.justfile'

# Show available commands
default:
    @just --list

# =============================================================================
# Deployment Commands
# =============================================================================

# Deploy API to Railway (add "prod" for production)
deploy-api env="preview":
    @echo "ðŸš€ Deploying API to Railway ({{ env }})..."
    railway up

# Deploy web to Vercel (add "prod" for production)
deploy-web env="preview":
    @echo "ðŸš€ Deploying web to Vercel ({{ env }})..."
    @cd web_frontend && if [ "{{ env }}" = "prod" ]; then vercel --prod; else vercel; fi

# =============================================================================
# Cleanup Commands
# =============================================================================

# Clean all build artifacts
clean:
    @echo "ðŸ§¹ Cleaning build artifacts..."
    @echo ""
    @echo "  Stopping Docker containers (releases file locks)..."
    @docker compose -f build/docker-compose.web-dev.yaml --project-directory . down 2>/dev/null || true
    @echo "  Removing target/..."
    @rm -rf target/ 2>/dev/null || true
    @echo "  Removing local Rust targets..."
    @rm -rf app/shared/target/ 2>/dev/null || true
    @rm -rf shared/target/ 2>/dev/null || true
    @echo "  Removing node_modules & .next/..."
    @rm -rf web_frontend/node_modules/ 2>/dev/null || true
    @rm -rf web_frontend/.next/ 2>/dev/null || true
    @echo "  Removing build logs..."
    @rm -f xcodebuild.log 2>/dev/null || true
    @echo "  Removing Xcode DerivedData..."
    @rm -rf ~/Library/Developer/Xcode/DerivedData/Thiccc-* 2>/dev/null || true
    @echo ""
    @echo "âœ… Clean complete!"
    @echo ""
    @echo "Note: Docker volumes preserved. To also reset Docker:"
    @echo "  just thiccc web reset"
